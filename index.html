<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#4CAF50">
    <meta name="description" content="App per quiz e test di preparazione agli esami">
    
    <title>Quiz Esame</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <!-- Preconnect per Firebase -->
    <link rel="preconnect" href="https://firestore.googleapis.com">
    
    <!-- Styles -->
    <link rel="stylesheet" href="style.css">
    
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="spinner"></div>
        <p>Caricamento...</p>
    </div>

    <!-- App Container -->
    <div id="app" class="app-container hidden">
        
        <!-- Header -->
        <header id="app-header" class="app-header">
            <button id="menu-btn" class="icon-btn" aria-label="Menu">
                <span class="material-icons">menu</span>
            </button>
            <h1 id="header-title">Quiz Esame</h1>
            <button id="user-btn" class="icon-btn" aria-label="Profilo">
                <img id="user-avatar" src="" alt="Avatar" class="user-avatar hidden">
                <span id="user-icon" class="material-icons">account_circle</span>
            </button>
        </header>

        <!-- Navigation Drawer -->
        <nav id="nav-drawer" class="nav-drawer">
            <div class="nav-header">
                <img id="nav-avatar" src="" alt="Avatar" class="nav-avatar">
                <div class="nav-user-info">
                    <div id="nav-username" class="nav-username"></div>
                    <div id="nav-email" class="nav-email"></div>
                </div>
            </div>
            <ul class="nav-menu">
                <li><a href="#home" class="nav-link active" data-view="home">
                    <span class="material-icons">home</span>
                    <span>Home</span>
                </a></li>
                <li><a href="#test" class="nav-link" data-view="test">
                    <span class="material-icons">quiz</span>
                    <span>Test</span>
                </a></li>
                <li><a href="#stats" class="nav-link" data-view="stats">
                    <span class="material-icons">bar_chart</span>
                    <span>Statistiche</span>
                </a></li>
                <li><a href="#settings" class="nav-link" data-view="settings">
                    <span class="material-icons">settings</span>
                    <span>Impostazioni</span>
                </a></li>
            </ul>
            <button id="logout-btn" class="logout-btn">
                <span class="material-icons">logout</span>
                <span>Esci</span>
            </button>
        </nav>

        <!-- Overlay -->
        <div id="drawer-overlay" class="drawer-overlay"></div>

        <!-- Main Content -->
        <main id="main-content" class="main-content">
            
            <!-- Home View -->
            <div id="view-home" class="view active">
                <div class="hero-section">
                    <div class="exam-card">
                        <h2 id="exam-title">Caricamento esame...</h2>
                        <p id="exam-subtitle" class="text-muted"></p>
                    </div>
                </div>

                <div class="quick-stats">
                    <div class="stat-card">
                        <span class="material-icons stat-icon">assignment</span>
                        <div class="stat-content">
                            <div class="stat-value" id="total-tests">0</div>
                            <div class="stat-label">Test Totali</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <span class="material-icons stat-icon success">check_circle</span>
                        <div class="stat-content">
                            <div class="stat-value" id="passed-tests">0</div>
                            <div class="stat-label">Superati</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <span class="material-icons stat-icon">percent</span>
                        <div class="stat-content">
                            <div class="stat-value" id="success-rate">0%</div>
                            <div class="stat-label">Successo</div>
                        </div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button id="start-test-btn" class="btn btn-primary btn-large">
                        <span class="material-icons">play_arrow</span>
                        <span>Inizia Nuovo Test</span>
                    </button>
                </div>

                <div class="recent-section" id="recent-section">
                    <h3>Ultimi Test</h3>
                    <div id="recent-tests" class="recent-tests">
                        <p class="text-muted text-center">Nessun test effettuato ancora</p>
                    </div>
                </div>

                <!-- Offline indicator -->
                <div id="offline-indicator" class="offline-indicator hidden">
                    <span class="material-icons">cloud_off</span>
                    <span>Modalità Offline</span>
                </div>
            </div>

            <!-- Test View -->
            <div id="view-test" class="view">
                <div class="test-container">
                    <div class="test-header">
                        <div class="progress-bar">
                            <div id="progress-fill" class="progress-fill"></div>
                        </div>
                        <div class="test-info">
                            <span id="question-counter">Risposte: 0/24</span>
                            <button id="quit-test-btn" class="btn btn-text btn-sm">
                                <span class="material-icons">close</span>
                                <span>Esci</span>
                            </button>
                        </div>
                    </div>

                    <div id="questions-container" class="questions-container">
                        <!-- All questions will be rendered here -->
                    </div>

                    <div class="test-actions">
                        <button id="submit-test-btn" class="btn btn-success btn-large hidden">
                            <span class="material-icons">send</span>
                            <span>Invia Risposte</span>
                        </button>
                    </div>
                </div>

                <!-- Results Modal -->
                <div id="results-modal" class="modal hidden">
                    <div class="modal-content">
                        <div class="results-header">
                            <div id="results-icon" class="results-icon"></div>
                            <h2 id="results-title">Test Completato!</h2>
                            <p id="results-subtitle"></p>
                        </div>
                        <div class="results-stats">
                            <div class="result-stat">
                                <span class="result-label">Punteggio</span>
                                <span id="result-score" class="result-value">0/24</span>
                            </div>
                            <div class="result-stat">
                                <span class="result-label">Percentuale</span>
                                <span id="result-percentage" class="result-value">0%</span>
                            </div>
                        </div>
                        <div class="modal-actions">
                            <button id="review-test-btn" class="btn btn-secondary btn-block">
                                <span class="material-icons">rate_review</span>
                                <span>Rivedi Risposte</span>
                            </button>
                            <button id="new-test-btn" class="btn btn-primary btn-block">
                                <span class="material-icons">refresh</span>
                                <span>Nuovo Test</span>
                            </button>
                            <button id="home-btn" class="btn btn-text btn-block">
                                <span class="material-icons">home</span>
                                <span>Torna alla Home</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats View -->
            <div id="view-stats" class="view">
                <div class="stats-container">
                    <h2>Le Tue Statistiche</h2>
                    
                    <div class="stats-overview">
                        <div class="stat-box">
                            <span class="material-icons">assignment</span>
                            <div>
                                <div class="stat-number" id="stats-total">0</div>
                                <div class="stat-text">Test Totali</div>
                            </div>
                        </div>
                        <div class="stat-box">
                            <span class="material-icons success">check_circle</span>
                            <div>
                                <div class="stat-number" id="stats-passed">0</div>
                                <div class="stat-text">Superati</div>
                            </div>
                        </div>
                        <div class="stat-box">
                            <span class="material-icons error">cancel</span>
                            <div>
                                <div class="stat-number" id="stats-failed">0</div>
                                <div class="stat-text">Non Superati</div>
                            </div>
                        </div>
                        <div class="stat-box">
                            <span class="material-icons">trending_up</span>
                            <div>
                                <div class="stat-number" id="stats-avg-errors">0</div>
                                <div class="stat-text">Media Errori</div>
                            </div>
                        </div>
                    </div>

                    <div class="top-errors-section">
                        <h3>
                            <span class="material-icons">error_outline</span>
                            <span>Domande più Sbagliate</span>
                        </h3>
                        <div id="top-errors-list" class="top-errors-list">
                            <p class="text-muted text-center">Nessun dato disponibile</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings View -->
            <div id="view-settings" class="view">
                <div class="settings-container">
                    <h2>Impostazioni</h2>
                    
                    <div class="settings-section">
                        <h3>Informazioni Esame</h3>
                        <div class="settings-item">
                            <span class="material-icons">school</span>
                            <div class="settings-text">
                                <div class="settings-label">Nome Esame</div>
                                <div id="settings-exam-name" class="settings-value">-</div>
                            </div>
                        </div>
                        <div class="settings-item">
                            <span class="material-icons">quiz</span>
                            <div class="settings-text">
                                <div class="settings-label">Domande Totali</div>
                                <div id="settings-total-questions" class="settings-value">-</div>
                            </div>
                        </div>
                        <div class="settings-item">
                            <span class="material-icons">check_circle</span>
                            <div class="settings-text">
                                <div class="settings-label">Punteggio Minimo</div>
                                <div id="settings-passing-score" class="settings-value">-</div>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>Sincronizzazione</h3>
                        <div class="settings-item">
                            <span class="material-icons" id="sync-icon">cloud_done</span>
                            <div class="settings-text">
                                <div class="settings-label">Stato</div>
                                <div id="sync-status" class="settings-value">Sincronizzato</div>
                            </div>
                            <button id="force-sync-btn" class="btn btn-sm btn-secondary">
                                <span class="material-icons">sync</span>
                            </button>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>Dati</h3>
                        <button id="clear-local-btn" class="btn btn-secondary btn-block">
                            <span class="material-icons">delete_sweep</span>
                            <span>Cancella Dati Locali</span>
                        </button>
                        <p class="settings-note">Rimuove i dati salvati localmente. I dati cloud saranno preservati.</p>
                    </div>

                    <div class="settings-section">
                        <h3>Account</h3>
                        <div class="settings-item">
                            <img id="settings-avatar" src="" alt="Avatar" class="settings-avatar">
                            <div class="settings-text">
                                <div id="settings-username" class="settings-label">-</div>
                                <div id="settings-email" class="settings-value">-</div>
                            </div>
                        </div>
                    </div>

                    <div class="settings-footer">
                        <p class="text-muted">Versione 2.0.0</p>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- Login Screen -->
    <div id="login-screen" class="login-screen">
        <div class="login-container">
            <div class="login-header">
                <span class="material-icons login-icon">school</span>
                <h1>Quiz Esame</h1>
                <p>Preparati al meglio per i tuoi esami</p>
            </div>
            <button id="google-login-btn" class="btn btn-google">
                <svg class="google-icon" viewBox="0 0 24 24">
                    <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                <span>Accedi con Google</span>
            </button>
            <p class="login-footer">Accedendo accetti i Termini di Servizio e l'Informativa sulla Privacy</p>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Firebase SDK -->
    <script type="module" src="app.js"></script>
</body>
</html>
